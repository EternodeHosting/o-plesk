$PhpParam = ''; $EncShDow = false; $YenidenDenePHP=0; YenidenDenePHP: if(DIRECTORY_SEPARATOR == "/" and is_file('/usr/local/cpanel/version')){ ini_set('allow_url_fopen','On'); ini_set('allow_url_include','On'); if(!is_file('/opt/cpanel/ea-php74/root/usr/bin/php') or !stristr(shell_exec('/opt/cpanel/ea-php74/root/usr/bin/php -v'),' v12.')){ shell_exec('yum remove -y ea-php74-php-ioncube* 2>&1'); shell_exec('yum install -y ea-php74-php-ioncube12 2>&1'); } if(is_file('/opt/cpanel/ea-php74/root/usr/bin/php')){ $PhpR='/opt/cpanel/ea-php74/root/usr/bin/php'; $PhpF='7.4'; $EncShDow = true; $PhpParam = ' -d allow_url_fopen=On -d allow_url_include=On '; }else{ exit("PHP v7.4 Sürümü ve IonCube Bulunamadı, Öncelikle bu sürümü kurunuz.\nKurulum Komutu:\nyum install -y ea-php74-php-ioncube11\n"); } // file_put_contents(sys_get_temp_dir().DIRECTORY_SEPARATOR.'EncIoncube.php',file_get_contents('https://ossav.com/OLC/EncIoncube-'.$PhpF.'.tpl')); // include(sys_get_temp_dir().DIRECTORY_SEPARATOR.'EncIoncube.php'); // echo sys_get_temp_dir().DIRECTORY_SEPARATOR; // exit; }elseif(is_file('/usr/local/psa/bin/license')){ @mkdir('/usr/local/psa/admin/lib/ioncube/',0777,true); $PhpV = trim(shell_exec('ls /opt/plesk/php/*/lib*/php/modules/ioncube_* 2>&1|egrep "5.6|7.0|7.4"|tail -1|cut -d/ -f5')); $PhpR = '/opt/plesk/php/'.$PhpV.'/bin/php'; /* if(empty($PhpV) and is_file('/usr/local/psa/admin/bin/php')){ $PhpV = trim(shell_exec('/usr/local/psa/admin/bin/php -r "\$P=explode(\'.\',phpversion());echo \$P[0].\'.\'.\$P[1];"')); $PhpR = '/usr/local/psa/admin/bin/php'; } */ if(in_array($PhpV,['5.6','7.0'])){ $PhpF='5.6'; }elseif($PhpV=='7.4'){ $PhpF='7.4'; } /* if(!empty($PhpV)){ file_put_contents('/usr/local/psa/admin/lib/ioncube/'.$PhpV.'.so',file_get_contents('http://storage.ossav.com/ioncube/ioncube_loader_lin_'.$PhpV.'.so')); file_put_contents('/usr/local/psa/admin/lib/ioncube/'.$PhpV.'_ts.so',file_get_contents('http://storage.ossav.com/ioncube/ioncube_loader_lin_'.$PhpV.'_ts.so')); file_put_contents('/etc/.os.'.$PhpV.'.php.ini',file_get_contents('http://ossav.com/OLC/php.ini.tpl')); } */ }elseif(DIRECTORY_SEPARATOR == "\\"){ $WinDirs = [ 'C:\\Program Files (x86)\\Parallels\\Plesk\\', 'C:\\Program Files (x86)\\Plesk\\', 'D:\\Program Files (x86)\\Plesk\\' ]; foreach($WinDirs as $WinDir){ if(is_file($WinDir.'bin\\license.exe')){ foreach(scandir($WinDir."Additional\\") as $dir){ if(in_array($dir,['PleskPHP56','PleskPHP70','PleskPHP74']) and is_dir($WinDir."Additional\\".$dir."\\ext\\")){ foreach(scandir($WinDir."Additional\\".$dir."\\ext\\") as $file){ if(strstr($file,'ioncube_')){ $PhpV = $dir; } } } } break; } } if(empty($PhpV))exit("PHP Ioncube Version Not Found.\n"); $PhpR = '"'.$WinDir.'Additional\\'.$PhpV.'\\php.exe"'; if($PhpV == 'PleskPHP56'){ shell_exec('bitsadmin /transfer debjob /download /priority normal "http://storage.ossav.com/ioncube_loader_win_5.6.dll" "'.$WinDir.'Additional\\'.$PhpV.'\\ext\\ioncube_loader_win_5.6.dll"'); $PhpF='5.6'; }elseif($PhpV == 'PleskPHP70'){ shell_exec('bitsadmin /transfer debjob /download /priority normal "http://storage.ossav.com/ioncube_loader_win_7.0.dll" "'.$WinDir.'Additional\\'.$PhpV.'\\ext\\ioncube_loader_win_7.0.dll"'); $PhpF='5.6'; }elseif($PhpV == 'PleskPHP74'){ shell_exec('bitsadmin /transfer debjob /download /priority normal "http://storage.ossav.com/ioncube_loader_win_7.4.dll" "'.$WinDir.'Additional\\'.$PhpV.'\\ext\\ioncube_loader_win_7.4.dll"'); $PhpF='7.4'; } if(!empty($PhpF)){ //$PhpParam=' -d zend_extension=opcache -d zend_extension="'.$WinDir.'Additional'.DIRECTORY_SEPARATOR.$PhpV.DIRECTORY_SEPARATOR.'ext'.DIRECTORY_SEPARATOR.'ioncube_loader_win_'.$PhpF.'.dll"'; $PHPINIc=file_get_contents($WinDir.'Additional'.DIRECTORY_SEPARATOR.$PhpV.DIRECTORY_SEPARATOR.'php.ini'); if(!strstr($PHPINIc,'ioncube_loader_win_'.$PhpF.'.dll')){ $PHPINIc = str_replace('zend_extension=opcache',PHP_EOL.'zend_extension="'.$WinDir.'Additional'.DIRECTORY_SEPARATOR.$PhpV.DIRECTORY_SEPARATOR.'ext'.DIRECTORY_SEPARATOR.'ioncube_loader_win_'.$PhpF.'.dll"'.PHP_EOL.'zend_extension=opcache',$PHPINIc); file_put_contents($WinDir.'Additional'.DIRECTORY_SEPARATOR.$PhpV.DIRECTORY_SEPARATOR.'php.ini',$PHPINIc); } } }else{ exit("Sistem Paneli Tespit Edilemesi.\n"); } if(empty($PhpF)){ shell_exec('plesk installer stop'.(DIRECTORY_SEPARATOR=='/'?' 2>&1':'.')); if($YenidenDenePHP == 0){ $YenidenDenePHP++; echo "PHP 7.4 Updating..."; $InstallPHP = shell_exec('plesk installer add --components php7'.(DIRECTORY_SEPARATOR=='/'?'.':'').'4'.(DIRECTORY_SEPARATOR=='/'?' 2>&1':'.')); if(stristr($InstallPHP,'ioncube') and stristr($InstallPHP,'successfully')){ echo " OK\n"; Goto YenidenDenePHP; }else{ echo " ERROR\n"; } } if($YenidenDenePHP == 1){ $YenidenDenePHP++; echo "PHP 7.0 Updating..."; $InstallPHP = shell_exec('plesk installer add --components php7'.(DIRECTORY_SEPARATOR=='/'?'.':'').'0'.(DIRECTORY_SEPARATOR=='/'?' 2>&1':'.')); if(stristr($InstallPHP,'ioncube') and stristr($InstallPHP,'successfully')){ echo " OK\n"; Goto YenidenDenePHP; }else{ echo " ERROR\n"; } } if($YenidenDenePHP == 2){ $YenidenDenePHP++; echo "PHP 5.6 Updating..."; $InstallPHP = shell_exec('plesk installer add --components php5'.(DIRECTORY_SEPARATOR=='/'?'.':'').'6'.(DIRECTORY_SEPARATOR=='/'?' 2>&1':'.')); if(stristr($InstallPHP,'ioncube') and stristr($InstallPHP,'successfully')){ echo " OK\n"; Goto YenidenDenePHP; }else{ echo " ERROR\n"; } } exit($PhpV." PHP Sürümüne Uygun Kodlama Bulunamadı.\n"); } if($EncShDow){ shell_exec('wget -O "'.dirname(trim($PhpR,'"')).DIRECTORY_SEPARATOR.'EncIoncube.php" "https://ossav.com/OLC/EncIoncube-'.$PhpF.'.tpl" 2>&1'); }else{ file_put_contents(dirname(trim($PhpR,'"')).DIRECTORY_SEPARATOR.'EncIoncube.php',file_get_contents('https://ossav.com/OLC/EncIoncube-'.$PhpF.'.tpl')); } if(empty(filesize(dirname(trim($PhpR,'"')).DIRECTORY_SEPARATOR.'EncIoncube.php'))){ exit("Encrypt PHP Dosya İndirilemedi. https://ossav.com/ IE ile erişiminiz olduğundan emin olunuz.\n"); }elseif(($fp=popen($PhpR.' -d disable_functions="" -d open_basedir="" '.$PhpParam.' "'.dirname(trim($PhpR,'"')).DIRECTORY_SEPARATOR.'EncIoncube.php"',"r"))){ while(!feof($fp)){ echo fread($fp,1024); flush(); } fclose($fp); } //echo shell_exec($PhpR.' "'.dirname(trim($PhpR,'"')).DIRECTORY_SEPARATOR.'EncIoncube.php"');
